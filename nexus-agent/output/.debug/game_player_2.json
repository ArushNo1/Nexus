{
  "lesson_plan": {
    "title": "Test Game",
    "objective": "Test",
    "content": "Test content"
  },
  "game_type": "platformer",
  "template_code": "<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Kaplay Platformer Template</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            background: #1a1a2e;\n            overflow: hidden;\n        }\n\n        canvas {\n            display: block;\n        }\n    </style>\n</head>\n\n<body>\n    <script src=\"https://unpkg.com/kaplay@3001.0.19/dist/kaplay.js\"></script>\n    <script>\n        // ============================================================\n        //  KAPLAY.JS PLATFORMER TEMPLATE\n        //  A simple, customizable foundation for any 2D platformer.\n        //  Uses built-in Kaplay sprites & shapes \u2014 no external assets.\n        // ============================================================\n\n        // ----- 1. GAME CONFIG (tweak these!) -----\n        // This object holds all user-tweakable constants.\n        // Keeping them in one place makes it easy to balance gameplay without hunting through code.\n        const CONFIG = {\n            // Physics\n            gravity: 1600, // Gravity force applied to all bodies (pixels/sec^2)\n            jumpForce: 650,  // Initial velocity for jumps\n            moveSpeed: 300,  // Horizontal movement speed\n            maxFallSpeed: 800,  // Cap on downward velocity to prevent \"tunneling\" through floors\n\n            // Player\n            playerStartPos: { x: 50, y: 0 }, // Default spawn point if level data is missing '@'\n            playerHealth: 3,    // Starting HP\n\n            // Camera\n            cameraFollow: true, // Whether the camera tracks the player\n\n            // Visuals\n            // Using a designated palette keeps the game looking consistent.\n            bgColor: [18, 18, 42],\n            floorColor: [60, 180, 120],\n            platformColor: [80, 140, 200],\n            hazardColor: [220, 60, 80],\n            coinColor: \n... [truncated, 17132 chars total]",
  "game_design_doc": "GAME_TYPE: platformer\n\nRATIONALE: The platformer template is ideal for a \"Test\" lesson because it allows for sequential progression through levels, mirroring a step-by-step testing or validation process. It provides a clear structure for introducing concepts one at a time as the player moves from left to right.\n\nADDON FEATURE: Logic Gates\nAt the end of each platforming section, the player encounters two doors labeled with different \"Test Results\" or \"Logic Statements.\" The player must jump into the door that correctly matches the \"Test Content\" displayed at the top of the screen; picking the correct door grants a score bonus and teleports the player to the next level, while the wrong door resets the current section.\n\nVISUAL THEME: The game is set inside a \"Virtual Testing Lab\" with a sleek, high-tech aesthetic. The player character is a \"QA Drone,\" enemies are floating \"Code Bugs,\" and the collectibles are \"Data Packets\" scattered across floating circuit-board platforms.",
  "design_feedback": "1. **Genre Fit: 5** \u2014 The platformer\u2019s linear progression is an excellent match for a step-by-step curriculum, allowing for a natural buildup of difficulty and concepts.\n2. **Pedagogical Alignment: 5** \u2014 The logic gate mechanic directly forces the player to evaluate the lesson content to succeed, moving beyond simple aesthetics into active learning.\n3. **Addon Feasibility: 5** \u2014 Implementing door-based collision triggers and UI text overlays is highly achievable within the Kaplay.js framework without requiring a core engine rewrite.\n4. **Visual Theme Coherence: 5** \u2014 The \"Virtual Testing Lab\" and \"QA Drone\" metaphors are perfectly aligned with a lesson about testing, making the educational context immediately intuitive.\n5. **Fun Factor: 4** \u2014 Using physical doors as choice-points integrates the assessment into the gameplay flow, though care must be taken to ensure the \"reset\" mechanic isn't too punishing.\n\n**DECISION: PASS**",
  "design_approved": true,
  "implementation_plan": "This technical plan transforms the platformer template into a **Virtual Testing Lab** where players control a **QA Drone** and solve **Logic Gates** to progress.\n\n### 1. Visual Reskin Plan\n\n#### Global Configuration (`CONFIG`)\nModify the `CONFIG` object to establish the sleek, high-tech palette.\n- **Background (`bgColor`):** Change to `[10, 10, 25]` (Deep Midnight Blue).\n- **Ground (`floorColor`):** Change to `[40, 60, 100]` (Steel Blue).\n- **Platforms (`platformColor`):** Change to `[0, 255, 255]` (Cyan).\n- **Hazard (`hazardColor`):** Change to `[255, 0, 100]` (Neon Magenta).\n- **Coin (`coinColor`):** Change to `[255, 255, 0]` (Bright Yellow).\n- **Portal (`portalColor`):** Change to `[150, 0, 255]` (Electric Purple).\n\n#### Game Objects (in `buildLevel`)\n- **Player Character (`@`):**\n  - **Now:** `sprite(\"bean\")`\n  - **New:** A metallic drone. Replace `sprite(\"bean\")` with a combination of components: `rect(24, 24, { radius: 4 })`, `color(200, 200, 220)`, and `outline(2, rgb(0, 255, 255))`.\n- **Enemies (`^` Code Bugs):**\n  - **Now:** Static magenta polygon.\n  - **New:** Add a `sine` wave movement to make them feel like \"floating bugs.\" Use `polygon()` with `color(...CONFIG.hazardColor)` and an `outline(1, rgb(255, 255, 255))`.\n- **Collectibles (`$` Data Packets):**\n  - **Now:** Yellow circle.\n  - **New:** `rect(16, 20)`, `color(...CONFIG.coinColor)`, `outline(2, rgb(0, 0, 0))`. Add a small `text(\"101\", { size: 8 })` child object inside to look like a data packet.\n- **Environment:**\n  - Add `outline(1, rgb(0, 255, 255))` to all ground blocks (`=`) to create a \"grid/circuit board\" look.\n\n#### HUD & Text\n- **HP Label:** Change text to `\"INTEGRITY: ${hp}\"`.\n- **Score Label:** Change text to `\"PACKETS: ${score}\"`.\n- **Level Label:** Change text to `\"TEST_PHASE: ${levelIdx + 1}\"`.\n\n---\n\n### 2. Addon Mechanic Implementation: Logic Gates\n\nThis mechanic adds a \"Logic Prompt\" at the top of the screen and two choice doors at the end of each level.\n\n#### A. New Data Structure\nA\n... [truncated, 4705 chars total]",
  "game_code": "<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Virtual Testing Lab: Logic Quest</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            background: #0a0a19;\n            overflow: hidden;\n            font-family: 'Courier New', Courier, monospace;\n        }\n\n        canvas {\n            display: block;\n        }\n    </style>\n</head>\n\n<body>\n    <!-- JSDoc Header: Educational Objectives -->\n    <script>\n        /**\n         * LESSON: Software Testing & Logic Gates\n         * \n         * OBJECTIVES:\n         * 1. Navigate a \"Test Environment\" (Platformer Levels).\n         * 2. Collect \"Data Packets\" (Score) and maintain \"Integrity\" (HP).\n         * 3. Validate system state using Logic Gates at the end of each phase.\n         * \n         * MECHANICS:\n         * - Run/Jump: Standard platforming controls.\n         * - Logic Gates: Evaluate a boolean condition (e.g., \"PACKETS > 5?\") and choose the correct door.\n         * - Dynamic Validation: The correct door depends on your gameplay performance.\n         */\n    </script>\n\n    <script src=\"https://unpkg.com/kaplay@3001/dist/kaplay.js\"></script>\n    <script>\n        // ============================================================\n        //  VIRTUAL TESTING LAB\n        // ============================================================\n\n        // ----- 1. GAME CONFIG -----\n        const CONFIG = {\n            // Physics\n            gravity: 1600,\n            jumpForce: 650,\n            moveSpeed: 300,\n            maxFallSpeed: 800,\n\n            // Player\n            playerStartPos: { x: 50, y: 0 },\n            playerHealth: 3,\n\n            // Camera\n            cameraFollow: true,\n\n            // Visuals (Neon/Cyberpunk Palette)\n            bgColor: [10, 10, 25],          // Deep Midnight Blue\n            floorColor: [40, 60, \n... [truncated, 19645 chars total]",
  "documentation": "<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Virtual Testing Lab: Logic Quest</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            background: #0a0a19;\n            overflow: hidden;\n            font-family: 'Courier New', Courier, monospace;\n        }\n\n        canvas {\n            display: block;\n        }\n    </style>\n</head>\n\n<body>\n    <!-- JSDoc Header: Educational Objectives -->\n    <script>\n        /**\n         * LESSON: Software Testing & Logic Gates\n         * \n         * OBJECTIVES:\n         * 1. Navigate a \"Test Environment\" (Platformer Levels).\n         * 2. Collect \"Data Packets\" (Score) and maintain \"Integrity\" (HP).\n         * 3. Validate system state using Logic Gates at the end of each phase.\n         * \n         * MECHANICS:\n         * - Run/Jump: Standard platforming controls.\n         * - Logic Gates: Evaluate a boolean condition (e.g., \"PACKETS > 5?\") and choose the correct door.\n         * - Dynamic Validation: The correct door depends on your gameplay performance.\n         */\n    </script>\n\n    <script src=\"https://unpkg.com/kaplay@3001/dist/kaplay.js\"></script>\n    <script>\n        // ============================================================\n        //  VIRTUAL TESTING LAB\n        // ============================================================\n\n        // ----- 1. GAME CONFIG -----\n        const CONFIG = {\n            // Physics\n            gravity: 1600,\n            jumpForce: 650,\n            moveSpeed: 300,\n            maxFallSpeed: 800,\n\n            // Player\n            playerStartPos: { x: 50, y: 0 },\n            playerHealth: 3,\n\n            // Camera\n            cameraFollow: true,\n\n            // Visuals (Neon/Cyberpunk Palette)\n            bgColor: [10, 10, 25],          // Deep Midnight Blue\n            floorColor: [40, 60, \n... [truncated, 19645 chars total]",
  "playtest_report": "# Game Evaluation Report\n\n**Final Verdict: FIX**\n\nThe game is mechanically sound and integrates the educational requirements of the GDD very well. However, there are significant visual alignment issues and technical deprecations that prevent it from being \"ship-ready.\"\n\n---\n\n### 1. Static Analysis\n**Score: 4/5**\n- **HTML Structure:** Valid.\n- **CDN Link:** Correct (Kaplay v3001).\n- **Syntax:** No syntax errors, but the browser explicitly flagged a performance-heavy `ReadPixels` stall and a deprecated API usage.\n\n### 2. Code Quality Review\n**Score: 3/5**\n- **Initialization:** Correct.\n- **Scene Management:** Correct.\n- **Error/Performance:** The runtime test results highlighted 5 warnings. The most concerning is the `camPos` deprecation. In Kaplay v3001, `camPos()` should be replaced with `getCamPos()` and `setCamPos()`.\n- **Logic Gates:** The logic implementation (mapping boolean checks to array indices) is clever and robust.\n\n### 3. Educational Alignment\n**Score: 5/5**\n- **GDD Match:** Perfectly matches the \"Virtual Testing Lab\" theme.\n- **Learning Objectives:** The \"Logic Gates\" based on actual gameplay performance (Packets and Integrity) is an excellent way to teach conditional logic.\n- **Knowledge Gates:** Integrated seamlessly into the level transitions.\n\n### 4. Playability Assessment\n**Score: 3/5**\n- **Start/End State:** Clear.\n- **Controls:** Functional, though not explicitly listed on the HUD for new players.\n- **UI/Accessibility:** The HUD is readable, but the **Logic Door placement** is problematic.\n- **Physics/Collisions:** The doors are anchored at `\"bot\"` and positioned at `y - 32`. Because the `>` tile and the floor tiles `=` share the same `y` coordinate in the map, the doors float exactly 1 tile (32px) above the ground. In Level 2, the door is placed even higher relative to the platform, making the \"hitbox\" awkward for a player to reach naturally.\n\n---\n\n### ERRORS:\n1. **Deprecated API:** The game uses `camPos()` for both getting and setting camera co\n... [truncated, 3194 chars total]",
  "ship_approved": true,
  "errors": [
    "1. **DEPRECATED API:** THE GAME USES `CAMPOS()` FOR BOTH GETTING AND SETTING CAMERA COORDINATES. THIS IS DEPRECATED IN KAPLAY V3001 AND SHOULD BE UPDATED TO `GETCAMPOS()` AND `SETCAMPOS()` TO ENSURE LONG-TERM STABILITY AND CLEAR CONSOLE LOGS.",
    "2. **VISUAL ALIGNMENT (FLOATING DOORS):** IN `BUILDLEVEL`, THE LOGIC DOORS ARE SPAWNED AT `Y - 32` WITH A `BOT` ANCHOR. SINCE `Y` IS THE TOP-LEFT OF THE TILE, THIS CAUSES THE DOOR TO HOVER ONE FULL TILE ABOVE THE FLOOR, WHICH LOOKS LIKE A BUG AND MAKES COLLISION DETECTION UNINTUITIVE FOR THE PLAYER.",
    "3. **PERFORMANCE STALL:** THE `READPIXELS` GPU STALL WARNING INDICATES THE RENDERING/LERPING OF THE CAMERA OR THE BACKGROUND PARTICLES MIGHT BE CAUSING UNNECESSARY OVERHEAD IN THE CURRENT CONFIGURATION."
  ],
  "design_iteration": 1,
  "code_iteration": 1,
  "status": "done"
}