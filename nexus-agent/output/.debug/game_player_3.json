{
  "lesson_plan": {
    "lessonPlan": {
      "title": "Introduction to Geometric Series",
      "duration": "60 minutes",
      "gradeLevel": "Level: 10th-11th Grade",
      "subject": "Mathematics",
      "objectives": [
        "Students will be able to define a geometric series and distinguish it from arithmetic series.",
        "Students will identify the common ratio and first term in a geometric series.",
        "Students will apply the formula for the sum of a finite geometric series: S_n = a\u2081(1-r\u207f)/(1-r).",
        "Students will solve real-world problems involving geometric series."
      ],
      "standards": [
        "CCSS.MATH.CONTENT.HSA.SSE.B.4: Derive the formula for the sum of a finite geometric series and use the formula to solve problems."
      ],
      "materials": [
        "Could not extract materials"
      ],
      "content": {
        "introduction": "Could not extract introduction",
        "procedure": "Could not extract procedure",
        "closure": "Could not extract closure"
      }
    },
    "rubric": {
      "title": "Extracted Rubric",
      "criteria": []
    },
    "assessments": [
      {
        "type": "Extracted Assessment",
        "title": "Assessment",
        "questions": [
          {
            "questionText": "- Formative: participation in guided practice examples.\n- Summative: Geometric series problem set accuracy.\n- Quiz (to be given next class):\n  1. What is the common ratio in the series 2, 6, 18, 54...? (3)\n  2. What is the formula for the sum of a finite geometric series? (S_n = a\u2081(1-r\u207f)/(1-r))\n  3. Find the sum of the first 5 terms of the series 3 + 6 + 12 + 24 + ... (93)",
            "options": [],
            "correctAnswer": "",
            "points": 0
          }
        ]
      }
    ]
  },
  "game_id": "3b71573a-9fc0-469e-8703-d0a78cb23d49",
  "game_type": "platformer",
  "template_code": "<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Kaplay Platformer Template</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            background: #1a1a2e;\n            overflow: hidden;\n        }\n\n        canvas {\n            display: block;\n        }\n    </style>\n</head>\n\n<body>\n    <script src=\"https://unpkg.com/kaplay@3001.0.19/dist/kaplay.js\"></script>\n    <script>\n        // ============================================================\n        //  KAPLAY.JS PLATFORMER TEMPLATE\n        //  A simple, customizable foundation for any 2D platformer.\n        //  Uses built-in Kaplay sprites & shapes \u2014 no external assets.\n        // ============================================================\n\n        // ----- 1. GAME CONFIG (tweak these!) -----\n        // This object holds all user-tweakable constants.\n        // Keeping them in one place makes it easy to balance gameplay without hunting through code.\n        const CONFIG = {\n            // Physics\n            gravity: 1600, // Gravity force applied to all bodies (pixels/sec^2)\n            jumpForce: 650,  // Initial velocity for jumps\n            moveSpeed: 300,  // Horizontal movement speed\n            maxFallSpeed: 800,  // Cap on downward velocity to prevent \"tunneling\" through floors\n\n            // Player\n            playerStartPos: { x: 50, y: 0 }, // Default spawn point if level data is missing '@'\n            playerHealth: 3,    // Starting HP\n\n            // Camera\n            cameraFollow: true, // Whether the camera tracks the player\n\n            // Visuals\n            // Using a designated palette keeps the game looking consistent.\n            bgColor: [18, 18, 42],\n            floorColor: [60, 180, 120],\n            platformColor: [80, 140, 200],\n            hazardColor: [220, 60, 80],\n            coinColor: \n... [truncated, 17132 chars total]",
  "game_design_doc": "GAME_TYPE: platformer\n\nRATIONALE: Geometric series are defined by a sequential progression of terms, which mirrors the linear movement of a 2D platformer. This genre allows the player to physically \"travel\" through the series, making the mathematical growth between terms feel like tangible progress through a level.\n\nADDON FEATURE: The Geometric Gateway\nAt the start of each level, a \"Target Ratio\" (e.g., r=3) and a \"First Term\" (e.g., a\u2081=2) are displayed at the top of the screen. Throughout the level, the player must collect \"Term Orbs\" that appear in their path; however, they must only collect the orbs that correctly follow the geometric sequence (2, 6, 18...). If the player collects an \"Arithmetic Impostor\" (a number that fits an addition pattern instead of multiplication, like 4 or 8), they lose a heart and their current \"Sum Streak\" resets. At the end of the level, the player must jump through one of three portals labeled with different values for $S_n$, requiring them to use the sum formula based on the number of correct orbs they collected to identify the right exit.\n\nVISUAL THEME: The game is set in \"Fractal Heights,\" a neon-colored digital dimension where platforms are made of glowing geometric shapes. The player character is \"Vector,\" a sleek robot, and the enemies are \"Static Errors\"\u2014glitchy addition signs (+)\u2014that try to knock the player into \"Arithmetic Abysses.\"",
  "design_feedback": "1. **Genre Fit: 5** \u2014 The platformer\u2019s inherent linear movement provides an excellent physical metaphor for the sequential progression of terms in a mathematical series.\n2. **Pedagogical Alignment: 5** \u2014 This addon directly addresses every lesson objective, from identifying variables to distinguishing between sequence types and applying the sum formula.\n3. **Addon Feasibility: 4** \u2014 Developing a collision-based collection system and an end-of-level conditional portal is straightforward within the Kaplay.js engine, though it requires careful tracking of the \"n\" variable.\n4. **Visual Theme Coherence: 5** \u2014 The neon digital theme and the clever use of addition signs as enemies provide a strong, intuitive visual contrast between the geometric and arithmetic concepts.\n5. **Fun Factor: 3** \u2014 The transition from fast-paced platforming to a potentially complex $S_n$ formula calculation at the portal may cause a jarring \"math wall\" that disrupts gameplay flow.\n\n**DECISION: PASS**",
  "design_approved": true,
  "implementation_plan": "This plan outlines the visual reskinning and the \"Geometric Gateway\" implementation for the Kaplay.js platformer template.\n\n### 1. Visual Reskin Plan\n\n**Theme: Fractal Heights**\nA neon-digital dimension with glowing geometric outlines.\n\n| Element | Current (Template) | New (Fractal Heights) | Exact Changes (Kaplay Components) |\n| :--- | :--- | :--- | :--- |\n| **Player** | `sprite(\"bean\")` | **Vector** (Robot) | Replace `sprite(\"bean\")` with `rect(24, 32), color(0, 255, 255), outline(2, rgb(255, 255, 255))` |\n| **Ground** | `rect(TILE, TILE)` (Green) | **Fractal Block** | `color(20, 20, 60), outline(2, rgb(100, 100, 255))` |\n| **Hazard** | `polygon` (Red Spike) | **Static Error** | Replace `polygon` with `text(\"+\", {size: 32}), color(255, 50, 50), area(), \"hazard\"` |\n| **Collectible** | `circle(10)` (Gold) | **Term Orb** | `circle(16), color(255, 0, 255), outline(2, rgb(255, 255, 255)), opacity(0.8)` |\n| **Exit Portal** | `rect` (Purple) | **Sum Portals** | 3 distinct `rect` portals labeled with text (e.g., \"Sum: 62\"). |\n| **Background** | `bgColor` (Navy) | **Deep Fractal** | `bgColor: [10, 10, 25]` |\n| **Text Labels** | Coins/HP | Sum Streak/Term Info | `size: 20, font: \"monospace\", color(255, 255, 255)` |\n\n---\n\n### 2. Addon Mechanic Implementation Plan: The Geometric Gateway\n\nThis mechanic tracks the progression of a geometric series ($a_n = a_1 \\cdot r^{n-1}$) and requires the player to select the correct sum ($S_n$) at the end.\n\n#### A. State Variables\nAdd these inside `scene(\"game\")` (Section 7):\n- `let firstA = choose([2, 3, 5]);` (Initial term $a_1$)\n- `let targetR = choose([2, 3]);` (Common ratio $r$)\n- `let currentN = 0;` (Number of correct orbs collected)\n- `let currentSum = 0;` (Running sum of collected correct orbs)\n- `let lastOrbValue = 0;`\n\n#### B. HUD Modifications (Section 7)\nModify the `hpLabel` and `scoreLabel` section:\n- **Series Info:** Add a label showing `Goal: a\u2081=${firstA}, r=${targetR}`.\n- **Sum Streak:** Rename `scoreLabel` to `sumLabel` to \n... [truncated, 4577 chars total]",
  "game_code": "<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Fractal Heights: Geometric Gateway</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            background: #0a0a1a;\n            overflow: hidden;\n            font-family: 'Courier New', Courier, monospace;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n        }\n\n        canvas {\n            display: block;\n            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);\n        }\n    </style>\n</head>\n\n<body>\n    <!-- Using Kaplay.js from CDN -->\n    <script src=\"https://unpkg.com/kaplay@3001/dist/kaplay.js\"></script>\n    <script>\n        /**\n         * EDUCATIONAL OBJECTIVES:\n         * 1. Recognize geometric sequences (a, ar, ar^2...).\n         * 2. Distinguish geometric growth (multiplication) from arithmetic growth (addition).\n         * 3. Calculate the partial sum of a geometric series (Sn) to identify the correct exit.\n         */\n\n        // ============================================================\n        //  GAME CONFIGURATION\n        // ============================================================\n\n        const CONFIG = {\n            // Physics\n            gravity: 1600,\n            jumpForce: 650,\n            moveSpeed: 300,\n            maxFallSpeed: 800,\n\n            // Camera\n            cameraFollow: true,\n\n            // Player\n            playerStartPos: { x: 50, y: 0 },\n            playerHealth: 3,\n\n            // Visuals - Fractal Heights Theme\n            bgColor: [16, 16, 37],         // Deep Fractal Blue\n            floorColor: [26, 26, 64],      // Dark Platform Block\n            floorOutline: [100, 100, 255], // Neon Blue Outline\n            playerColor: [0, 255, 255],    // Vector Cyan\n            hazardColor: [255, 50, 80],    \n... [truncated, 24257 chars total]",
  "documentation": "<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Fractal Heights: Geometric Gateway</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            background: #0a0a1a;\n            overflow: hidden;\n            font-family: 'Courier New', Courier, monospace;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n        }\n\n        canvas {\n            display: block;\n            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);\n        }\n    </style>\n</head>\n\n<body>\n    <!-- Using Kaplay.js from CDN -->\n    <script src=\"https://unpkg.com/kaplay@3001/dist/kaplay.js\"></script>\n    <script>\n        /**\n         * EDUCATIONAL OBJECTIVES:\n         * 1. Recognize geometric sequences (a, ar, ar^2...).\n         * 2. Distinguish geometric growth (multiplication) from arithmetic growth (addition).\n         * 3. Calculate the partial sum of a geometric series (Sn) to identify the correct exit.\n         */\n\n        // ============================================================\n        //  GAME CONFIGURATION\n        // ============================================================\n\n        const CONFIG = {\n            // Physics\n            gravity: 1600,\n            jumpForce: 650,\n            moveSpeed: 300,\n            maxFallSpeed: 800,\n\n            // Camera\n            cameraFollow: true,\n\n            // Player\n            playerStartPos: { x: 50, y: 0 },\n            playerHealth: 3,\n\n            // Visuals - Fractal Heights Theme\n            bgColor: [16, 16, 37],         // Deep Fractal Blue\n            floorColor: [26, 26, 64],      // Dark Platform Block\n            floorOutline: [100, 100, 255], // Neon Blue Outline\n            playerColor: [0, 255, 255],    // Vector Cyan\n            hazardColor: [255, 50, 80],    \n... [truncated, 24257 chars total]",
  "playtest_report": "# Game Evaluation Report: Fractal Heights: Geometric Gateway\n\n## 1. Static Analysis\n**Score: 4/5**\n- **HTML Structure:** Valid.\n- **CDN Link:** Correct (Kaplay v3001).\n- **Syntax:** No JavaScript syntax errors.\n- **Components:** All components (`pos`, `rect`, `area`, `body`, etc.) are standard.\n- **Issues:** The code uses the deprecated `camPos()` function for both getting and setting camera coordinates, which was flagged by the runtime test. While functional, it produces console warnings that should be resolved in a production environment.\n\n## 2. Code Quality Review\n**Score: 4/5**\n- **Initialization:** `kaplay()` is configured correctly with a custom resolution and crisp rendering.\n- **Scene Management:** Scenes (`game`, `gameover`, `win`) are well-defined.\n- **Performance:** The \"GPU stall due to ReadPixels\" warning in the headless test is likely due to the `addKaboom` particle effects or the heavy use of `outline` in a headless environment. In standard browsers, this is rarely a bottleneck for a 2D platformer.\n- **Logic:** The level building logic\u2014specifically sorting orbs by X-coordinate to ensure a logical linear sequence\u2014is excellent and prevents player confusion.\n\n## 3. Educational Alignment\n**Score: 4/5**\n- **GDD Match:** The game follows the \"Fractal Heights\" theme and \"Vector\" character description. It correctly identifies geometric vs. arithmetic patterns.\n- **Learning Objectives:** The math logic is sound. It differentiates between $a \\cdot r^n$ (Geometric) and $a + (n \\cdot d)$ (Arithmetic).\n- **Knowledge Gates:** The portal system effectively forces the player to calculate the sum $S_n$ before exiting.\n- **Issues:** \n    - The GDD states that the \"Sum Streak\" should **reset** on an error. The current code only subtracts 10 points: `sumStreak = Math.max(0, sumStreak - 10);`.\n    - The documentation block is present and accurate.\n\n## 4. Playability Assessment\n**Score: 5/5**\n- **Controls:** Clearly documented on-screen and intuitive (WASD/Arrows).\n- **Fee\n... [truncated, 3115 chars total]",
  "ship_approved": false,
  "errors": [],
  "design_iteration": 1,
  "code_iteration": 2,
  "status": "coding"
}